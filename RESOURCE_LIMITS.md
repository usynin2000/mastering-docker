# üìä –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ (Resource Limits) –≤ Docker

### üéì –¢–µ–æ—Ä–∏—è

#### –ó–∞—á–µ–º –Ω—É–∂–Ω—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤?
–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä Docker –Ω–µ –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ —Ö–æ—Å—Ç-—Å–∏—Å—Ç–µ–º—ã. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–∂–µ—Ç —Å—ä–µ—Å—Ç—å –≤—Å—é –ø–∞–º—è—Ç—å —Ö–æ—Å—Ç–∞
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –≤—Å–µ CPU —Ö–æ—Å—Ç–∞
- –û–¥–∏–Ω "–ø–ª–æ—Ö–æ–π" –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–∂–µ—Ç –ø–∞—Ä–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Å—é —Å–∏—Å—Ç–µ–º—É

–†–µ–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π:
–ü—Ä–µ–¥—Å—Ç–∞–≤—å, —á—Ç–æ —É —Ç–µ–±—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∑–∞–ø—É—â–µ–Ω–æ 10 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:
- 9 –∏–∑ –Ω–∏—Ö —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- –û–¥–∏–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –±–∞–≥–æ–º –Ω–∞—á–∏–Ω–∞–µ—Ç –ø–æ—Ç—Ä–µ–±–ª—è—Ç—å 16 GB RAM
- –†–µ–∑—É–ª—å—Ç–∞—Ç: —Ö–æ—Å—Ç-—Å–∏—Å—Ç–µ–º–∞ –∑–∞–≤–∏—Å–∞–µ—Ç, –≤—Å–µ 10 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –ø–∞–¥–∞—é—Ç

> –†–µ—à–µ–Ω–∏–µ: —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–∏–º–∏—Ç—ã —Ä–µ—Å—É—Ä—Å–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.


### üß† –ß—Ç–æ —Ç–∞–∫–æ–µ cgroups?

> cgroups (Control Groups) ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º —è–¥—Ä–∞ Linux, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å, —É—á–∏—Ç—ã–≤–∞—Ç—å –∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã (CPU, –ø–∞–º—è—Ç—å, I/O) –¥–ª—è –≥—Ä—É–ø–ø –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.

Docker –∏—Å–ø–æ–ª—å–∑—É–µ—Ç cgroups –¥–ª—è:
1. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (limits) ‚Äî –º–∞–∫—Å–∏–º—É–º —Ä–µ—Å—É—Ä—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
2. –£—á—ë—Ç–∞ (accounting) ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, —Å–∫–æ–ª—å–∫–æ —Ä–µ—Å—É—Ä—Å–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç
3. –ò–∑–æ–ª—è—Ü–∏–∏ ‚Äî –ø—Ä–æ—Ü–µ—Å—Å—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –Ω–µ –≤–∏–¥—è—Ç –∏ –Ω–µ –º–µ—à–∞—é—Ç –ø—Ä–æ—Ü–µ—Å—Å–∞–º –¥—Ä—É–≥–∏—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤


–ì–¥–µ –∂–∏–≤—É—Ç cgroups?
```shell
# –í Linux cgroups —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ /sys/fs/cgroup/
ls /sys/fs/cgroup/
```

–¢–∞–º —Ç—ã —É–≤–∏–¥–∏—à—å –ø–æ–¥–∫–∞—Ç–∞–ª–æ–≥–∏:
- memory/ ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é
- cpu/ ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ CPU
- blkio/ ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∏—Å–∫–æ–≤—ã–º I/O


Docker –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å–≤–æ—é cgroup.


### üíæ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ (--memory)

–ë–∞–∑–æ–≤—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
```shell
docker run --memory <—Ä–∞–∑–º–µ—Ä> <–æ–±—Ä–∞–∑>
```

–§–æ—Ä–º–∞—Ç—ã —Ä–∞–∑–º–µ—Ä–∞:
- b ‚Äî –±–∞–π—Ç—ã
- k ‚Äî –∫–∏–ª–æ–±–∞–π—Ç—ã
- m ‚Äî –º–µ–≥–∞–±–∞–π—Ç—ã
- g ‚Äî –≥–∏–≥–∞–±–∞–π—Ç—ã

–ü—Ä–∏–º–µ—Ä—ã
```shell
# –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä 512 –º–µ–≥–∞–±–∞–π—Ç–∞–º–∏
docker run --memory 512m nginx

# –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä 1 –≥–∏–≥–∞–±–∞–π—Ç–æ–º
docker run --memory 1g nginx

# –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä 100 –º–µ–≥–∞–±–∞–π—Ç–∞–º–∏
docker run --memory 100m alpine sleep 1000
```

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞?
–ï—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø—ã—Ç–∞–µ—Ç—Å—è –≤—ã–¥–µ–ª–∏—Ç—å –±–æ–ª—å—à–µ –ø–∞–º—è—Ç–∏, —á–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–æ:

1. OOM Killer (Out-Of-Memory Killer) —è–¥—Ä–∞ Linux —É–±–∏–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å
2. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π exit code 137

> Exit code 137 = –ø—Ä–æ—Ü–µ—Å—Å –±—ã–ª —É–±–∏—Ç —Å–∏–≥–Ω–∞–ª–æ–º SIGKILL (–æ–±—ã—á–Ω–æ –∏–∑-–∑–∞ OOM)


### üîÑ --memory-swap: –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç swap –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö?

**–ß—Ç–æ —Ç–∞–∫–æ–µ swap?**

- **Swap** ‚Äî —ç—Ç–æ –æ–±–ª–∞—Å—Ç—å –Ω–∞ –¥–∏—Å–∫–µ, –∫–æ—Ç–æ—Ä—É—é –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–∞–∫ "–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –ø–∞–º—è—Ç—å", –∫–æ–≥–¥–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è —Ñ–∏–∑–∏—á–µ—Å–∫–∞—è RAM.

–í–∞–∂–Ω–æ: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ swap –º–µ–¥–ª–µ–Ω–Ω–µ–µ RAM –≤ –¥–µ—Å—è—Ç–∫–∏ —Ä–∞–∑, –Ω–æ —ç—Ç–æ –ª—É—á—à–µ, —á–µ–º –∫—Ä—ç—à –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

–°–∏–Ω—Ç–∞–∫—Å–∏—Å
```shell
docker run --memory <RAM> --memory-swap <RAM+SWAP> <–æ–±—Ä–∞–∑>
```

–ü—Ä–∞–≤–∏–ª–æ:
- --memory ‚Äî –ª–∏–º–∏—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –ø–∞–º—è—Ç–∏ (RAM)
- --memory-swap ‚Äî –æ–±—â–∏–π –ª–∏–º–∏—Ç RAM + SWAP

–§–æ—Ä–º—É–ª–∞:
```shell
SWAP = --memory-swap - --memory
```

–ü—Ä–∏–º–µ—Ä—ã
–ü—Ä–∏–º–µ—Ä 1: –†–∞–∑—Ä–µ—à–∏—Ç—å 512 MB RAM + 512 MB SWAP
```shell
docker run --memory 512m --memory-swap 1g nginx
```

–†–∞—Å—á—ë—Ç:
RAM = 512 MB
SWAP = 1024 MB - 512 MB = 512 MB


–ü—Ä–∏–º–µ—Ä 2: –ë–µ–∑ swap (—Ç–æ–ª—å–∫–æ RAM)
```shell
docker run --memory 512m --memory-swap 512m nginx
```
–†–∞—Å—á—ë—Ç:
RAM = 512 MB
SWAP = 512 MB - 512 MB = 0 MB (swap –æ—Ç–∫–ª—é—á—ë–Ω)


–ü—Ä–∏–º–µ—Ä 3: –ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–π swap
```shell
docker run --memory 512m --memory-swap -1 nginx
```
- RAM = 512 MB
- SWAP = –±–µ–∑–ª–∏–º–∏—Ç–Ω—ã–π (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–µ—Å—å swap —Ö–æ—Å—Ç–∞)

‚ö†Ô∏è –û–ø–∞—Å–Ω–æ –≤ production! –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã.- 


## ‚ö° –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ CPU (--cpus)

–°–∏–Ω—Ç–∞–∫—Å–∏—Å
```shell
docker run --cpus <–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ> <–æ–±—Ä–∞–∑>
```

> **--cpus** —É–∫–∞–∑—ã–≤–∞–µ—Ç **–¥—Ä–æ–±–Ω–æ–µ —á–∏—Å–ª–æ CPU-—è–¥–µ—Ä**, –∫–æ—Ç–æ—Ä—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.

–ü—Ä–∏–º–µ—Ä—ã:
```shell
# –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞–∫—Å–∏–º—É–º 1 –ø–æ–ª–Ω–æ–µ CPU-—è–¥—Ä–æ
docker run --cpus 1 nginx

# –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 50% –æ—Ç –æ–¥–Ω–æ–≥–æ —è–¥—Ä–∞
docker run --cpus 0.5 nginx

# –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 2 –ø–æ–ª–Ω—ã—Ö —è–¥—Ä–∞
docker run --cpus 2 nginx

# –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 25% –æ—Ç –æ–¥–Ω–æ–≥–æ —è–¥—Ä–∞
docker run --cpus 0.25 nginx
```

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?
Docker –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **CFS (Completely Fair Scheduler)** —á–µ—Ä–µ–∑ cgroups.

–ú–µ—Ö–∞–Ω–∏–∑–º:
- CPU –¥–µ–ª–∏—Ç—Å—è –Ω–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–≤–∞–Ω—Ç—ã (–æ–±—ã—á–Ω–æ 100 –º—Å)
- –ï—Å–ª–∏ —Ç—ã —É–∫–∞–∑–∞–ª --cpus 0.5:
    - –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç 50 –º—Å –Ω–∞ –∫–∞–∂–¥—ã–µ 100 –º—Å
    - –û—Å—Ç–∞–ª—å–Ω—ã–µ 50 –º—Å ‚Äî –¥–ª—è –¥—Ä—É–≥–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤


**–†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É --cpus –∏ --cpu-shares**

–í–æ—Ç —Ç–∞–±–ª–∏—Ü–∞ –≤ Markdown:

| –§–ª–∞–≥         | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç                           | –ü–æ–≤–µ–¥–µ–Ω–∏–µ                               |
|--------------|--------------------------------------|-----------------------------------------|
| `--cpus`     | –ñ—ë—Å—Ç–∫–∏–π –ª–∏–º–∏—Ç (hard limit)           | –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—Å–∏—Ç—å –ª–∏–º–∏—Ç      |
| `--cpu-shares` | –ú—è–≥–∫–∏–π –ª–∏–º–∏—Ç (soft limit, –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –≤–µ—Å) | –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–π CPU |



–ü—Ä–∏–º–µ—Ä --cpu-shares:
```shell
# –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä A –ø–æ–ª—É—á–∏—Ç –≤ 2 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ CPU, —á–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä B
docker run --cpu-shares 2048 --name A nginx
docker run --cpu-shares 1024 --name B nginx
```

‚ö†Ô∏è Shares —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ CPU –∑–∞–≥—Ä—É–∂–µ–Ω. –ï—Å–ª–∏ CPU —Å–≤–æ–±–æ–¥–µ–Ω ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∫–æ–ª—å–∫–æ —É–≥–æ–¥–Ω–æ.


# üé¨ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –¥–ª—è –≤–∏–¥–µ–æ

### –î–µ–º–æ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ –ø–∞–º—è—Ç–∏
–°–æ–∑–¥–∞–¥–∏–º Python-—Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π "—Å—ä–µ–¥–∞–µ—Ç" –ø–∞–º—è—Ç—å:
stress_memory.py:
```python
# –í—ã–¥–µ–ª—è–µ–º –º–Ω–æ–≥–æ –ø–∞–º—è—Ç–∏ (1 GB)
data = []
try:
    for i in range(1000):
        # –ö–∞–∂–¥–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è –≤—ã–¥–µ–ª—è–µ—Ç ~1 MB
        data.append(" " * (1024 * 1024))
        print(f"–í—ã–¥–µ–ª–µ–Ω–æ: {i} MB")
except MemoryError:
    print("–ü–∞–º—è—Ç—å –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å!")
```

Dockerfile:
```Dockerfile
FROM python:3.11-slim
WORKDIR /app
COPY stress_memory.py .
CMD ["python", "stress_memory.py"]
```

–°–æ–±–µ—Ä—ë–º –æ–±—Ä–∞–∑:
```shell
docker build -t stress-mem .
```

**–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç 1: –ë–µ–∑ –ª–∏–º–∏—Ç–∞**
```shell
docker run stress-mem
```

–†–µ–∑—É–ª—å—Ç–∞—Ç: —Å–∫—Ä–∏–ø—Ç –≤—ã–¥–µ–ª–∏—Ç ~1 GB –ø–∞–º—è—Ç–∏, –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç.


**–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç 2: –° –ª–∏–º–∏—Ç–æ–º 100 MB**
```shell
docker run --memory 100m stress-mem
```
–†–µ–∑—É–ª—å—Ç–∞—Ç: –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –±—É–¥–µ—Ç —É–±–∏—Ç OOM Killer –ø—Ä–∏–º–µ—Ä–Ω–æ –Ω–∞ 100-–π –∏—Ç–µ—Ä–∞—Ü–∏–∏.

–ü—Ä–æ–≤–µ—Ä–∏–º exit code:
```shell
docker ps -a
# NAMES: stress-mem
# STATUS: Exited (137)
```
Exit code 137 = –ø—Ä–æ—Ü–µ—Å—Å —É–±–∏—Ç –∏–∑-–∑–∞ –Ω–µ—Ö–≤–∞—Ç–∫–∏ –ø–∞–º—è—Ç–∏.


### –î–µ–º–æ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ CPU
–°–æ–∑–¥–∞–¥–∏–º —Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π **–Ω–∞–≥—Ä—É–∂–∞–µ—Ç CPU:**
stress_cpu.py:
```python
import time

# –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–≥—Ä—É–∂–∞–µ—Ç 1 —è–¥—Ä–æ CPU –Ω–∞ 100%
count = 0
start = time.time()
while True:
    count += 1
    if count % 100_000_000 == 0:
        elapsed = time.time() - start
        print(f"–ü—Ä–æ—à–ª–æ {elapsed:.2f} —Å–µ–∫—É–Ω–¥, –∏—Ç–µ—Ä–∞—Ü–∏–π: {count}")
```

Dockerfile:
```Dockerfile
FROM python:3.11-slim
WORKDIR /app
COPY stress_cpu.py .
CMD ["python", "stress_cpu.py"]
```

–°–æ–±–µ—Ä—ë–º:
```shell
docker build -t stress-cpu .
```

**–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç 1: –ë–µ–∑ –ª–∏–º–∏—Ç–∞**
```shell
docker run stress-cpu
```

–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å?
- –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ: docker stats –ø–æ–∫–∞–∂–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É CPU/–ø–∞–º—è—Ç–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.
- –ù–∞ macOS: —à—Ç–∞—Ç–Ω—ã–π top -o cpu –∏–ª–∏ top -stats pid,command,cpu,mem -o cpu.
- –ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏: –æ—Ç–∫—Ä–æ–π Activity Monitor (–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã) ‚Üí –∫–æ–ª–æ–Ω–∫–∞ CPU.


**–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç 2: –û–≥—Ä–∞–Ω–∏—á–∏–º 50% CPU**
```shell
docker run --cpus 0.5 stress-cpu
```
–¢–µ–ø–µ—Ä—å –ø—Ä–æ—Ü–µ—Å—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ 50% –æ—Ç –æ–¥–Ω–æ–≥–æ —è–¥—Ä–∞.


**–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç 3: –û–≥—Ä–∞–Ω–∏—á–∏–º 25% CPU**
```shell
docker run --cpus 0.25 stress-cpu
```
–ü—Ä–æ—Ü–µ—Å—Å –∑–∞–º–µ–¥–ª–∏—Ç—Å—è –µ—â—ë —Å–∏–ª—å–Ω–µ–µ ‚Äî —Ç–æ–ª—å–∫–æ 25% –æ—Ç —è–¥—Ä–∞.


### –î–µ–º–æ 3: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
Docker –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—É –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
```shell
docker stats
```

–í—ã–≤–æ–¥:
```shell
CONTAINER ID   NAME          CPU %     MEM USAGE / LIMIT   MEM %
a1b2c3d4e5f6   stress-cpu    50.00%    10.5MiB / 512MiB    2.05%
```

–ß—Ç–æ –≤–∏–¥–Ω–æ:
- CPU % ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è CPU
- MEM USAGE / LIMIT ‚Äî —Ç–µ–∫—É—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ / –ª–∏–º–∏—Ç
- MEM % ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –ª–∏–º–∏—Ç–∞


### –î–µ–º–æ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ cgroups –Ω–∞–ø—Ä—è–º—É—é
–ó–∞–ø—É—Å—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –∏–º–µ–Ω–µ–º:
```shell
docker run -d --name test --memory 256m --cpus 0.5 nginx
```

–ù–∞–π–¥–∏ ID –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
```shell
docker inspect test --format '{{.Id}}'
```

–¢–µ–ø–µ—Ä—å –∑–∞–π–¥–∏ –≤ cgroups (Linux):
```shell
# –ü–µ—Ä–µ–π–¥–∏ –≤ cgroups –¥–ª—è —ç—Ç–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
cd /sys/fs/cgroup/memory/docker/<CONTAINER_ID>

# –ü–æ—Å–º–æ—Ç—Ä–∏ –ª–∏–º–∏—Ç –ø–∞–º—è—Ç–∏
cat memory.limit_in_bytes
# –í—ã–≤–æ–¥: 268435456 (—ç—Ç–æ 256 MB –≤ –±–∞–π—Ç–∞—Ö)

# –ü–æ—Å–º–æ—Ç—Ä–∏ —Ç–µ–∫—É—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
cat memory.usage_in_bytes
```

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è CPU:
```shell
cd /sys/fs/cgroup/cpu/docker/<CONTAINER_ID>

# –ü–æ—Å–º–æ—Ç—Ä–∏ –∫–≤–æ—Ç—É CPU
cat cpu.cfs_quota_us
cat cpu.cfs_period_us
```

–†–∞—Å—á—ë—Ç CPU –∏–∑ cgroups:
```shell
CPU = cpu.cfs_quota_us / cpu.cfs_period_us
```

–ü—Ä–∏–º–µ—Ä:
cpu.cfs_quota_us = 50000
cpu.cfs_period_us = 100000
CPU = 50000 / 100000 = 0.5 (50% –æ—Ç –æ–¥–Ω–æ–≥–æ —è–¥—Ä–∞)


## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –¥–ª—è production
1. –í—Å–µ–≥–¥–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π –ª–∏–º–∏—Ç—ã –≤ production
```shell
docker run -d \
  --name myapp \
  --memory 512m \
  --memory-swap 512m \
  --cpus 1 \
  myapp:latest
```

2. –ò—Å–ø–æ–ª—å–∑—É–π Docker Compose –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
```yaml
version: '3.8'
services:
  web:
    image: nginx
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 512M
        reservations:
          cpus: '0.5'
          memory: 256M
```


–†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É limits –∏ reservations:
- limits ‚Äî –º–∞–∫—Å–∏–º—É–º (hard limit)
- reservations ‚Äî –º–∏–Ω–∏–º—É–º (–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ—Å—É—Ä—Å)


3. –ú–æ–Ω–∏—Ç–æ—Ä—å —Ä–µ—Å—É—Ä—Å—ã
- docker stats ‚Äî –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞
- Prometheus + cAdvisor ‚Äî –¥–ª—è production
- Grafana ‚Äî –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏


üéØ –ò—Ç–æ–≥–∏ –¥–ª—è –≤–∏–¥–µ–æ
–ö–ª—é—á–µ–≤—ã–µ –∏–¥–µ–∏:
1. cgroups ‚Äî –º–µ—Ö–∞–Ω–∏–∑–º —è–¥—Ä–∞ Linux –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è —Ä–µ—Å—É—Ä—Å–æ–≤
2. --memory ‚Äî –∂—ë—Å—Ç–∫–∏–π –ª–∏–º–∏—Ç RAM (–ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ ‚Üí OOM Kill)
3. --memory-swap ‚Äî –æ–±—â–∏–π –ª–∏–º–∏—Ç RAM + SWAP
4. --cpus ‚Äî –¥—Ä–æ–±–Ω–æ–µ —á–∏—Å–ª–æ CPU-—è–¥–µ—Ä (–∂—ë—Å—Ç–∫–∏–π –ª–∏–º–∏—Ç)
5. docker stats ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
6. –í—Å–µ–≥–¥–∞ —Å—Ç–∞–≤—å –ª–∏–º–∏—Ç—ã –≤ production, —á—Ç–æ–±—ã –∑–∞—â–∏—Ç–∏—Ç—å—Å—è –æ—Ç "–ø–ª–æ—Ö–∏—Ö" –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

–ü—Ä–∞–∫—Ç–∏–∫–∞ –¥–ª—è –≤–∏–¥–µ–æ:
- –î–µ–º–æ —Å Python-—Å–∫—Ä–∏–ø—Ç–æ–º, –∫–æ—Ç–æ—Ä—ã–π "—Å—ä–µ–¥–∞–µ—Ç" –ø–∞–º—è—Ç—å
- –î–µ–º–æ —Å CPU-–Ω–∞–≥—Ä—É–∑–∫–æ–π –∏ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ–º –≤ htop
- –ü–æ–∫–∞–∑–∞—Ç—å docker stats –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- (–ë–æ–Ω—É—Å) –ó–∞–π—Ç–∏ –≤ /sys/fs/cgroup/ –∏ –ø–æ–∫–∞–∑–∞—Ç—å cgroups –∏–∑–Ω—É—Ç—Ä–∏